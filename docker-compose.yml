version: '3.8'

services:
  bcsf-monitoring-interface:
    build: .
    container_name: bcsf-monitoring-interface
    ports:
      - "80:80"
    environment:
      # Project configuration
      - PROJECT_ID=${PROJECT_ID:-scope3-dev}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      
      # Bucket configurations
      - RESEARCH_BUCKET=${RESEARCH_BUCKET}
      - META_BRAND_SAFETY_OUTPUT_BUCKET=${META_BRAND_SAFETY_OUTPUT_BUCKET}
      - CHECKING_BUCKET=${CHECKING_BUCKET}
      
      # Google Cloud credentials
      - GOOGLE_APPLICATION_CREDENTIALS=/app/credentials.json
      
      # Streamlit configuration
      - STREAMLIT_SERVER_PORT=80
      - STREAMLIT_SERVER_ADDRESS=0.0.0.0
      - STREAMLIT_SERVER_HEADLESS=true
      - STREAMLIT_SERVER_ENABLE_CORS=false
      - STREAMLIT_SERVER_ENABLE_XSRF_PROTECTION=false
    volumes:
      # Mount .env file if it exists
      - ./.env:/app/.env:ro
      # Mount Google Cloud credentials from project root
      - ./credentials.json:/app/credentials.json:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - bcsf-network

networks:
  bcsf-network:
    driver: bridge 